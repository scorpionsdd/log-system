--**************************** SCRIPT BD ***************************
/*
PONER ATENCION EN LOS ESQUEMAS DE LOS SIGUIENTES 
SCRIPTS Y AJUSTAR EN "Log.Layer.Business.ControlLog"
*/

--************* CREA SECUENCIA *************
CREATE SEQUENCE LOGSYSTEM_LogId_SEQ START WITH 1 INCREMENT BY 1 NoCache NoCycle;

--************* CREA TABLA *************
CREATE TABLE CGESTION.BITACORA (
"BITACORAID" NUMBER(*,0) NOT NULL ENABLE, 
	"USUARIOID" NUMBER(*,0), 
	"FECHAEVENTO" DATE, 
	"MODULO" VARCHAR2(500), 
	"ACCION" VARCHAR2(100), 
	"ESBD" CHAR(1), 
	"TABLA" VARCHAR2(100), 
	"SENTENCIA" VARCHAR2(4000), 
	"IP" VARCHAR2(100), 
	"METADATO" NCLOB, 
	"SESIONID" VARCHAR2(100), 
	"EXPEDIENTE" VARCHAR2(200), 
	"CAMPO_1" VARCHAR2(4000), 
	"CAMPO_2" VARCHAR2(4000),
	CONSTRAINT LOGSYSTEM_PK PRIMARY KEY (BITACORAID)
)
TABLESPACE SISTEMAS_GESTION;

--************* CREA TRIGGER *************
CREATE OR REPLACE TRIGGER Trg_Insert_LOGSYSTEM_LogId
BEFORE INSERT ON CGESTION.BITACORA
FOR EACH ROW
BEGIN
  IF :NEW.BITACORAID IS NULL THEN
    SELECT LOGSYSTEM_LogId_SEQ.NEXTVAL INTO :NEW.BITACORAID FROM dual;
  END IF;
END;


--**************************** CONSIDERACIONES ***************************

1.- REVISAR LOS SETTINGS DE ESTE PROYECTO PARA MODIFICAR "ConnectionString" APUNTANDO A LA BD DESEADA
2.- DEL AJUSTE ANTERIOR ASEGURARSE EXISTAN LOS OBJETOS DE SCRIPTS DE SECCION PREVIA

